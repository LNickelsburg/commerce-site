{% extends "base.html" %}

{% block content %}

<br><br>
<h1>Account</h1>
{% if not current_user.is_authenticated %}
<p><a href="{{ url_for('users.login', next=url_for('account.account')) }}">Log in</a> to see your account information!</p>
{% else %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h3>{{ current_user.firstname }} {{ current_user.lastname }}, User #{{current_user.id}} </h3>
    <!-- TODO: button to view public profile -->
    <button type="button" class="btn btn-secondary">
        View Public Profile
    </button>
</div>
<br><br><br>

<h2>Information</h2><hr><br>
<div style="display: flex; justify-content: space-around;">
  <div class="account-information">
    
    <h3>Account Information:</h3>
    <table class='table table-hover table-bordered container left-aligned narrow-column'>
      <tbody>
        <tr>
          <th scope="row">Full Name:</th>
          <td>{{ current_user.firstname }} {{ current_user.lastname }}</td>
          <td>
            <input type="submit" value="Edit" data-toggle="modal" data-target="#editNameModal"/>
                <!-- Modal -->
                <div class="modal fade" id="editNameModal" tabindex="-1" role="dialog" aria-labelledby="editNameModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editNameModalLabel">Edit Name</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form method="POST" action="{{ url_for('account.edit_name') }}">
                          <input type="hidden" name="user_id" value="{{ current_user.id }}" />
                          <div class="form-group">
                            <label for="first-name">First Name</label>
                            <input type="text" class="form-control" id="first-name" name="first_name" value="{{ current_user.firstname }}" required>
                          </div>
                          <div class="form-group">
                            <label for="last-name">Last Name</label>
                            <input type="text" class="form-control" id="last-name" name="last_name" value="{{ current_user.lastname }}" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Save changes</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </td>
        </tr>
        <!-- TODO: users have addresses -->
        <tr>
          <th scope="row">Email:</th>
          <td>{{ current_user.email }}</td>
          <td>
            <input type="submit" value="Edit" data-toggle="modal" data-target="#editEmailModal"/>
                <!-- Modal -->
                <div class="modal fade" id="editEmailModal" tabindex="-1" role="dialog" aria-labelledby="editEmailModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editEmailModalLabel">Edit Email</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form method="POST" action="{{ url_for('account.edit_email') }}">
                          <input type="hidden" name="user_id" value="{{ current_user.id }}" />
                          <div class="form-group">
                            <label for="email">Email</label>
                            <input type="text" class="form-control" id="email" name="email" value="{{ current_user.email }}" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Save changes</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </td>
        </tr>
        <tr>
          <th scope="row">Password:</th>
          <!-- TODO: option to make password visible? -->
          <td>••••••••</td>
          <td>
            <input type="submit" value="Edit" data-toggle="modal" data-target="#editPasswordModal"/>
                <!-- Modal -->
                <div class="modal fade" id="editPasswordModal" tabindex="-1" role="dialog" aria-labelledby="editPasswordModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editPasswordModalLabel">Change Password</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form method="POST" action="{{ url_for('account.change_password') }}">
                          <input type="hidden" name="user_id" value="{{ current_user.id }}" />
                          <div class="form-group">
                            <label for="password">New Password</label>
                            <input type="text" class="form-control" id="password" name="password" required>
                          </div>

                          <button type="submit" class="btn btn-primary">Save changes</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </td>
        </tr>
        
      </tbody>   
    </table>
  </div>
  <div class="balance-information">
    <h3>Balance:</h3>
    <table class='table table-hover table-bordered left-aligned'>
      <tbody>
        <tr>
          <th scope="row" class="narrow-column">Current Balance:</th>
          <td>
            <!-- TODO: find most recent balance with this user's user_id -->
            ${{ balance }}
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div style="display: flex; justify-content: space-around;">
              <!-- TODO: deposit balance -->
              <input type="submit" value="Deposit"/>
              <!-- TODO: withdraw balance -->
              <input type="submit" value="Withdraw"/>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

  </div>
 
</div>
<br>
<strong>Account Type:</strong>
{% if seller_check %}
    Seller
{% else %}
    Standard
    <!-- TODO: option to become a seller account -->
    <div style="padding-left: 10px;">
      <p>Click <a href="{{ url_for('users.delete') }}">here</a> to create a seller account.</p>
    </div>
{% endif %}

<br><br><br>


<h2>Activity</h2><hr><br>
<!-- TODO: transaction history -->
<div class="history">
  <h3>Transaction History:</h3>
  <table class='table table-hover table-bordered left-aligned'style="text-align: center;">
    <tbody>
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Description</th>
        <th scope="col">Amount</th>
        <th scope="col">Resulting Balance</th>
      </tr>
      
    </tbody>   
  </table>
</div>
<br>
<!-- TODO: purchase history -->
<div class="history">
  <h3>Purchase History:</h3>
  <table class='table table-hover table-bordered container' style="text-align: center;">
    <tbody>
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Fulfillment Status</th>
        <th scope="col">Number of Items</th>
        <th scope="col">Total Price</th>
        <th scope="col">Details</th>
      </tr>
    </tbody>   
  </table>
</div>
<!-- TODO: (for sellers) order history-->
{% if seller_check %}
  <div class="history">
    <h3>Seller History:</h3>
    <table class='table table-hover table-bordered container' style="text-align: center;">
      <tbody>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Fulfillment Status</th>
          <th scope="col">Number of Items</th>
          <th scope="col">Total Price</th>
          <th scope="col">Details</th>
        </tr>
      </tbody>   
    </table>
  </div>
{% endif %}

<br><br><br>
<h2>Danger Zone :(</h2><hr><br>
<!-- TODO: delete account -->
<p>To permanently delete your account, click <a href="{{ url_for('users.delete') }}">here</a>.</p>

{% endif %}
{% endblock %}